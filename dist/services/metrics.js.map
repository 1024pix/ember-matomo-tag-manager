{"version":3,"file":"metrics.js","sources":["../../src/services/metrics.js"],"sourcesContent":["import Service from '@ember/service';\nimport { getOwner } from '@ember/application';\nimport MatomoTagManager from '../metrics-adapters/MatomoTagManager';\n\nexport default class Metrics extends Service {\n  _adapter = null;\n\n  context = {};\n\n  appEnvironment = null;\n\n  constructor() {\n    super(...arguments);\n\n    const owner = getOwner(this);\n\n    const config = owner.factoryFor('config:environment').class;\n    const { metrics = [] } = config;\n    this.enabled = config.metrics.enabled === true;\n    const { environment = 'development' } = config;\n\n    this._options = { metrics, environment };\n    if (!this.enabled) {\n      return;\n    }\n    this._adapter = new MatomoTagManager(this._options.metrics);\n    this._adapter.install();\n  }\n\n  // eslint-disable-next-line ember/classic-decorator-hooks\n  initialize() {}\n\n  identify() {\n    this.invoke('identify', ...arguments);\n  }\n\n  add() {\n    this.invoke('add', ...arguments);\n  }\n\n  trackPage() {\n    this.invoke('trackPage', ...arguments);\n  }\n\n  invoke(methodName, options) {\n    if (!this.enabled) {\n      return;\n    }\n\n    this._adapter[methodName]({ ...this.context, ...options });\n  }\n\n  willDestroy() {\n    if (!this.enabled) {\n      return;\n    }\n    this._adapter.uninstall();\n  }\n}\n"],"names":["Metrics","Service","constructor","arguments","_defineProperty","owner","getOwner","config","factoryFor","class","metrics","enabled","environment","_options","_adapter","MatomoTagManager","install","initialize","identify","invoke","add","trackPage","methodName","options","context","willDestroy","uninstall"],"mappings":";;;;AAIe,MAAMA,OAAO,SAASC,OAAO,CAAC;AAO3CC,EAAAA,WAAWA,GAAG;IACZ,KAAK,CAAC,GAAGC,SAAS,CAAC,CAAA;AAACC,IAAAA,eAAA,mBAPX,IAAI,CAAA,CAAA;IAAAA,eAAA,CAAA,IAAA,EAAA,SAAA,EAEL,EAAE,CAAA,CAAA;AAAAA,IAAAA,eAAA,yBAEK,IAAI,CAAA,CAAA;AAKnB,IAAA,MAAMC,KAAK,GAAGC,QAAQ,CAAC,IAAI,CAAC,CAAA;IAE5B,MAAMC,MAAM,GAAGF,KAAK,CAACG,UAAU,CAAC,oBAAoB,CAAC,CAACC,KAAK,CAAA;IAC3D,MAAM;AAAEC,MAAAA,OAAO,GAAG,EAAA;AAAG,KAAC,GAAGH,MAAM,CAAA;IAC/B,IAAI,CAACI,OAAO,GAAGJ,MAAM,CAACG,OAAO,CAACC,OAAO,KAAK,IAAI,CAAA;IAC9C,MAAM;AAAEC,MAAAA,WAAW,GAAG,aAAA;AAAc,KAAC,GAAGL,MAAM,CAAA;IAE9C,IAAI,CAACM,QAAQ,GAAG;MAAEH,OAAO;AAAEE,MAAAA,WAAAA;KAAa,CAAA;AACxC,IAAA,IAAI,CAAC,IAAI,CAACD,OAAO,EAAE;AACjB,MAAA,OAAA;AACF,KAAA;IACA,IAAI,CAACG,QAAQ,GAAG,IAAIC,gBAAgB,CAAC,IAAI,CAACF,QAAQ,CAACH,OAAO,CAAC,CAAA;AAC3D,IAAA,IAAI,CAACI,QAAQ,CAACE,OAAO,EAAE,CAAA;AACzB,GAAA;;AAEA;EACAC,UAAUA,GAAG,EAAC;AAEdC,EAAAA,QAAQA,GAAG;AACT,IAAA,IAAI,CAACC,MAAM,CAAC,UAAU,EAAE,GAAGhB,SAAS,CAAC,CAAA;AACvC,GAAA;AAEAiB,EAAAA,GAAGA,GAAG;AACJ,IAAA,IAAI,CAACD,MAAM,CAAC,KAAK,EAAE,GAAGhB,SAAS,CAAC,CAAA;AAClC,GAAA;AAEAkB,EAAAA,SAASA,GAAG;AACV,IAAA,IAAI,CAACF,MAAM,CAAC,WAAW,EAAE,GAAGhB,SAAS,CAAC,CAAA;AACxC,GAAA;AAEAgB,EAAAA,MAAMA,CAACG,UAAU,EAAEC,OAAO,EAAE;AAC1B,IAAA,IAAI,CAAC,IAAI,CAACZ,OAAO,EAAE;AACjB,MAAA,OAAA;AACF,KAAA;AAEA,IAAA,IAAI,CAACG,QAAQ,CAACQ,UAAU,CAAC,CAAC;MAAE,GAAG,IAAI,CAACE,OAAO;MAAE,GAAGD,OAAAA;AAAQ,KAAC,CAAC,CAAA;AAC5D,GAAA;AAEAE,EAAAA,WAAWA,GAAG;AACZ,IAAA,IAAI,CAAC,IAAI,CAACd,OAAO,EAAE;AACjB,MAAA,OAAA;AACF,KAAA;AACA,IAAA,IAAI,CAACG,QAAQ,CAACY,SAAS,EAAE,CAAA;AAC3B,GAAA;AACF;;;;"}